# アーカイブ機能（要件定義）

## ゴール

- Discord 等で共有された URL を収集し、OGP/メタ情報を取得・保存・一覧/検索/参照できること。
- Cloudflare Pages + D1 を前提とし、低運用コストで安定稼働すること。

## スコープ

- 対象: 一般ユーザー向けのアーカイブ閲覧、管理者の基本的な管理操作。
- 含む: URL 受領、OGP 抽出、D1 への保存、一覧・詳細表示、削除リクエスト受付。
- 含まない: 高度なレコメンド、全文検索（必要になれば別要件化）。

## 主要ユースケース（簡易）

1. Bot/Hook が URL を受領し、OGP 情報を抽出して D1 に保存する。
2. 一般ユーザーは一覧でアーカイブを閲覧し、詳細を参照する。
3. 管理者は詳細を参照し、必要に応じて削除リクエストを処理する。

## 非機能要件

- セキュリティ: 外部取得した `responseBody` 等の生データは外部通知に載せない。保存は最小限とし、監査目的のトレースはメタ情報中心とする。
- パフォーマンス: OGP 取得はタイムアウト/リトライを設け、キューイングやバックオフで負荷平準化する（将来の拡張点）。
- ユーザー体験: 一覧は軽量で高速表示。取得失敗時は「再取得」オプションやステータス表示で分かりやすく。
- アクセシビリティ: 画像には代替テキストを付与。キーボード操作で一覧・詳細を操作可能に。
- トレーサビリティ: 取得時刻、取得ステータス、実行元（ジョブ URL など）を保存し、原因追跡を容易にする。

## 受け入れ基準（例）

- URL を通知すると 1 分以内に一覧へ反映される（成功時）。
- 取得失敗時は一覧に「失敗」ステータスが表示され、詳細で理由が分かる。
- 削除リクエストは D1 に保存され、管理者画面で状態遷移できる。

## 参考

- データモデル/ER 図: [docs/data/README.md](../docs/data/README.md)
- 実装/構成メモ: [docs/functions/archive/README.md](../docs/functions/archive/README.md)
