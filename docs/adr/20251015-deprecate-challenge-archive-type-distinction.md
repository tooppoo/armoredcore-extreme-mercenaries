# Slash Command移行に伴うチャレンジアーカイブのtype区別廃止

- ステータス: 承認済み
- 日付: 2025-10-15
- タグ: discord, slash-command, archive, refactoring

技術ストーリー: Slash Command移行により、チャレンジアーカイブの登録方式を統一し、`type: 'text' | 'link'` による分岐ロジックを廃止

## 背景 / 文脈

従来のチャレンジアーカイブ機能では、メッセージ監視による登録をサポートしており、入力内容に応じて `type: 'text'`（テキストのみ）と `type: 'link'`（URL付き）の2つのタイプに分岐していた。しかし、Slash Command移行により、コマンドの引数（`title`、`url`、`description`）で全ての情報を統一的に扱えるようになったため、この分岐ロジックが不要となった。

## 決定ドライバ

- **Slash Command仕様**: コマンド引数によりURL/テキストを統一的に扱える
- **コードの複雑性削減**: 不要な分岐ロジックを除去し保守性を向上
- **一貫性**: 全てのアーカイブをURLベースで統一
- **メッセージ監視の廃止**: 旧来の登録方式をサポートする必要がなくなった

## 検討した選択肢

1. type区別を維持し、Slash Commandでも分岐ロジックを使用
2. type区別を廃止し、URLベースのアーカイブに統一
3. 段階的移行（両方式を並行サポート）

## 決定（採択）

選択したオプション: "type区別を廃止し、URLベースのアーカイブに統一"。理由: Slash Commandの引数体系により分岐が不要となり、コードの複雑性を大幅に削減できるため。

## 影響評価

- **セキュリティ**: 影響なし / 分岐ロジック削除により攻撃面が減少
- **パフォーマンス**: 軽微な改善 / 分岐処理の削除により処理が高速化
- **ユーザー体験**: 改善 / Slash Commandにより操作が統一され直感的に
- **アクセシビリティ**: 改善 / コマンド形式により支援技術との互換性向上
- **トレーサビリティ**: 改善 / ログ出力が単純化され追跡が容易に

### ポジティブな影響

- **コード品質向上**: 複雑な分岐ロジックの削除により保守性が向上
- **統一性**: 全てのアーカイブ操作がSlash Commandで統一
- **型安全性**: TypeScript型定義が単純化され、型エラーのリスクが減少
- **テスト性**: テストケースが単純化され、カバレッジが向上

### ネガティブな影響 / トレードオフ

- **後方互換性**: 旧来のテキストアーカイブ方式は使用不可（ただし、すでにメッセージ監視を廃止済みのため実質的影響なし）
- **移行コスト**: 既存コードの修正が必要（ただし、一度限りの作業）

## 各選択肢の利点と欠点

### type区別を維持し、Slash Commandでも分岐ロジックを使用

- 良い点: 既存コードの変更が最小限
- 良い点: 旧来の概念との一貫性を保持
- 悪い点: 不要な複雑性を維持することになる
- 悪い点: Slash Commandの利点を活かせない

### type区別を廃止し、URLベースのアーカイブに統一

- 良い点: コードの複雑性が大幅に削減される
- 良い点: Slash Commandの仕様に最適化される
- 良い点: 保守性と型安全性が向上する
- 良い点: テストが単純化される
- 悪い点: 既存コードの修正が必要

### 段階的移行（両方式を並行サポート）

- 良い点: リスクを最小限に抑えた移行が可能
- 悪い点: 移行期間中はより複雑になる
- 悪い点: 最終的に全ての修正が必要で作業量は変わらない

## フォローアップ / 移行計画

- ✅ `upsertChallenge` 関数のtype分岐削除
- ✅ `validateChallengeCommand` の戻り値型統一
- ✅ `buildChallengeArchiveFromText` 関数の削除
- ✅ テストケースの新仕様への対応
- ✅ 型チェックとテストの確認

## 参考リンク

- [AGENTS.md](../AGENTS.md) - 設計原則（SHOULD: 可逆性 > 低結合 = 高凝集 = 直交性 > KISS = YAGNI > DRY）
- [Discord Slash Commands Documentation](https://discord.com/developers/docs/interactions/application-commands#slash-commands)
