# アーカイブテーブルを統合するか分割するか

- ステータス: 承認済み
- 日付: 2025-01-25
- タグ: アーキテクチャ, テーブル設計, DB構造

技術ストーリー: 動画アーカイブとチャレンジアーカイブのスキーマ設計方針を決定し、将来の拡張や保守性を高めたい。

## 背景 / 文脈

動画アーカイブ（サムネイル必須）とチャレンジアーカイブ（画像は任意）を同一テーブルで管理するか、別テーブルに分けるかが課題だった。両者はタイトル・説明・出典リンクといった共通項目を持つ一方で、画像扱いや拡張要件が異なるため、同一テーブルでは NULL カラムや条件分岐が増える懸念があった。

## 決定ドライバ

- 共通項目は多いが、種別固有カラムの有無で要件が分岐する。
- 将来的に新しいアーカイブ種別やカラム追加が想定される。
- スキーマをシンプルに保ち、保守性を高めたい。
- 動画とチャレンジを一括検索したい需要も一部存在する。

## 検討した選択肢

1. すべてのアーカイブを 1 テーブルに統合する。
2. 動画とチャレンジでテーブルを 2 つに分割する（採択）。
3. 親テーブル + 種別ごとの子テーブル（クラステーブル継承）に分ける。

## 決定（採択）

動画アーカイブとチャレンジアーカイブを別テーブルで管理する。サムネイル必須と任意といった要件差分を吸収しやすく、将来的な拡張時にも相互影響を最小化できるため最適と判断した。

## 影響評価

### ポジティブな影響

- 不要な NULL カラムが減り、スキーマが明確化される。
- 種別ごとの機能追加や変更がしやすく、保守性が向上する。

### ネガティブな影響

- 全アーカイブを横断検索・集計するケースでは `UNION` などの追加実装が必要。
- 共通のバリデーションやロジックを重複実装する可能性がある。

## その他検討事項

- 単一テーブル案はクエリ実装が単純だが、将来的な分岐で複雑化しやすい。
- 親子テーブル構造は冗長性を下げられるが、小規模構成ではオーバーエンジニアリングになりやすい。
