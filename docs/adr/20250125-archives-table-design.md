# アーカイブテーブルを統合するか分割するか

- ステータス: 承認済み
- タグ: [アーキテクチャ, テーブル設計, DB構造]

技術ストーリー:
アーカイブの種類 (動画アーカイブ / チャレンジアーカイブ) ごとに異なるカラムを持たせるべきか、テーブルを分割するべきかどうか。  
また、将来的に新しいアーカイブ種別が追加される可能性も考慮して検討する。

---

## 背景と問題の説明

動画アーカイブ(サムネイル画像必須)とチャレンジアーカイブ(画像の有無は任意)を同じテーブルにまとめるか、別テーブルに分割するかについて検討する必要がある。  
両者には共通する項目（タイトル・説明・出典リンクなど）はあるものの、画像の扱いや今後の拡張要件が異なる可能性があるため、DBスキーマをどう設計すべきかが問題となっている。

---

## 決定要因

- **共通項目の割合**: タイトル、説明、出典リンクなど共通フィールドは多いが、動画は画像が必須でチャレンジは必須ではない。
- **将来的な拡張の可能性**: 新たなカラムや別種のアーカイブ追加の見込み。
- **スキーマのシンプルさ**: 1テーブルにまとめると NULL カラムが増える懸念や条件分岐が増大する恐れがある。
- **検索・集計の仕方**: 動画とチャレンジを一括検索するケース vs. 別々に扱うケースのどちらが多いか。

---

## 検討した選択肢

1. アーカイブを1つのテーブルに統合する  
1. アーカイブを動画テーブルとチャレンジテーブルの2つに分割する  
1. 親テーブル + 種別ごとの子テーブル(クラステーブル継承)  

---

## 決定結果

「アーカイブを動画テーブルとチャレンジテーブルの2つに分割する」。  

理由は、動画固有のサムネイルカラムやチャレンジ固有の拡張を個別に追加しやすく、将来的な要件の分岐に対応しやすいこと、かつテーブル構造を簡潔に保てるため最適と判断した。

### ポジティブな影響

- 不要なNULLカラムを減らし、カラム定義を明確化することで保守性が向上する。  
- 動画とチャレンジで管理ロジックを変える際も、スキーマ変更の影響を相互に与えにくい。  

### ネガティブな影響

- 動画とチャレンジを一括で検索・集計する場面では、2テーブルを `UNION` するなどの追加実装が必要になる。  
- 同種のバリデーションや基本カラムを2つのテーブルに重複して実装する可能性がある。  

---

## 各選択肢の利点と欠点

### 選択肢1: アーカイブを1つのテーブルに統合

- 良い点:  
  - テーブル数が少なく、DB構造が単純。  
  - 一括検索・集計が容易。  
- 悪い点:  
  - 動画アーカイブとチャレンジアーカイブで不要なカラムが増えがちで、スキーマが煩雑になる。  
  - 将来的に要件が大きく分岐した際に管理が難しくなる。  

### 選択肢2: アーカイブを動画テーブルとチャレンジテーブルの2つに分割 (**今回の採択**)

- 良い点:  
  - 各テーブルが固有要素にフォーカスできるためシンプル。  
  - 動画用/チャレンジ用の要件追加や変更があっても相互影響を最小化できる。  
- 悪い点:  
  - 両方のアーカイブを同時に扱う際、複数テーブルを扱うロジックやクエリが必要。  
  - 共通処理やバリデーションを重複実装する可能性がある。  

### 選択肢3: 親テーブル + 種別ごとの子テーブル

- 良い点:  
  - 共通カラムは親テーブルに集約し、専用カラムは子テーブルに持てるため冗長性が下がる。  
  - 将来的にアーカイブ種別を追加してもスキーマを拡張しやすい。  
- 悪い点:  
  - テーブルが増え、INSERT/UPDATE時には複数テーブルへの書き込みが必要。  
  - 小規模な場合、オーバーエンジニアリングになりかねない。  

---

## リンク
