# 依存追加チェックリスト

## 前提

- `AGENTS.md` の「セキュリティ」および「依存追加の承認手順」に必ず従う。
- 依存はバージョンを完全に固定し、最小権限構成・機微情報保護を維持する。

## チェックリスト

- [ ] 導入目的がユースケース観点で明確（***UDD*** 優先）。
- [ ] 既存の依存や標準機能で代替できないと判断した根拠がある。
- [ ] 対象ライブラリのライセンスとメンテナンス状況（最終リリース日・既知のCVE）を確認した。
- [ ] 導入するバージョン（例: `1.2.3`）を特定し、固定バージョンで利用する計画を立てた。
- [ ] 追加によるセキュリティ・パフォーマンス影響を評価し、必要なら測定方法を準備した。
- [ ] テスト方針（自動テスト更新・手動手順書）が整理されている。
- [ ] 承認依頼前にロールバック方法（アンインストール・設定削除）が把握できている。

## 承認依頼テンプレート

```txt
この依存が作業に必要だが、このバージョンで追加して良いか？
- パッケージ: <名前>
- バージョン: <固定バージョン>
- 用途: <ユースケース>
- 代替検討: <既存で代替できない理由>
- 想定影響: <セキュリティ/パフォーマンスへの考慮>
```

※ Issue 作成は不要。承認が得られるまで依存追加作業は開始しない。

## 承認後の対応

- [ ] 承認者と承認日時を開発ノートやコミットメッセージに記録した。
- [ ] 導入手順・ロールバック手順を反映した。
- [ ] テスト・ドキュメントを更新し、`docs/terms.md` や ***ADR*** への追記が必要な場合は実施した。
- [ ] 変更内容を構造化ログや監視設定が参照する場合は整合性を確認した。

## Cloudflare Pages Functions Discord Bot 運用メモ

- Secrets は Cloudflare Pages プロジェクトの環境変数として管理する。ローカル `.dev.vars` にはダミー値のみを記載し、`DISCORD_PUBLIC_KEY` / `DISCORD_BOT_TOKEN` / `DISCORD_ALLOWED_*` / `DISCORD_DEV_ALERT_CHANNEL_ID` / `D1_DB` を本番環境でのみ設定する。
- 依存監査ログ
  - 2025-10-05: packages/front で `pnpm audit` を実行。`@noble/ed25519@3.0.0`（MIT）に既知の脆弱性はなく、署名検証用途として継続採用する。一方でトランジティブ依存 `esbuild<=0.24.2`（`drizzle-kit` 経由）に GHSA-67mh-4wv8-2f99 が報告されているため、`drizzle-kit` のアップデート監視とビルド経路への未組み込み（開発専用利用）を維持する。
