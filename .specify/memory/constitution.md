<!-- Sync Impact Report: Version 2.1.1 → 3.0.0; 追加済み原則: 原則I/II/III/IV/V; 追加セクション: 非機能・設計ガードレール, 開発ワークフローとレビュー; 削除セクション: なし; テンプレート更新状況: ✅ .specify/templates/plan-template.md, ✅ .specify/templates/spec-template.md, ✅ .specify/templates/tasks-template.md; Follow-up TODOs: なし -->
# ac-extreme-mercenaries Constitution

## Core Principles

### 原則I: 要求トレーサビリティの厳格維持
- すべての要求は `docs/requests/` に5W1Hと検証可能な受入基準を明記し、流れはシナリオ→要件→ユースケース→仕様→設計→実装→テストの順序で派生させる。
- 下位成果物には必ず対応する上位要求の参照を記載し、矛盾や逸脱が発生した場合は `docs/adr/` に方針を記録して是正する。
- 要件策定時に国際化(i18n)・アクセシビリティ(a11y)の適用可否を評価し、対象外の場合は理由・影響・代替策を要件ドキュメントに明示する。
- ドキュメント・回答・コメントは日本語で統一し、例外として実行時ログとメトリクスの文言は英語で構造化出力とする。
理由: 要求に基づく成果物連鎖を保証し、監査時にも意図と逸脱の判断を容易にするため。

### 原則II: テスト駆動と品質可視化の徹底
- クリティカル経路はユニットテストとE2Eテストを必ず整備し、TDD(Red-Green-Refactor)の順序を守る。
- カバレッジ計測を有効化し、主要モジュールのカバレッジをレビューで確認できる状態を維持する。
- 構造化ログやマスキング規則はテストで検証し、機微情報を含む疑似データで漏洩を防ぐ。
- 失敗事例は簡易ポストモーテムとしてADRに残し、再発防止策をテストに反映する。
理由: 品質基準をテストで担保し、リグレッションや運用リスクを継続的に検知するため。

### 原則III: 構造化可観測性と相関追跡
- ログはJSON等の構造化形式で出力し、エラーおよび主要イベントには相関IDを付与する。
- 機微情報はログに出力せず、必要な属性はマスキング規則を仕様とテストで保証する。
- 監査や障害解析のため、トレーサビリティを設計段階で考慮し、必要なメトリクス・アラートを最小構成で整備する。
理由: 障害原因追跡と運用透明性を確保し、個人情報漏洩リスクを最小化するため。

### 原則IV: セキュリティと秘密管理の最優先
- Secrets/APIキー等はコードに直書きせず、Secrets管理や環境変数で供給し、更新手順を設計・仕様に残す。
- 依存ライブラリの脆弱性チェックをCIまたはローカルで定期実行し、重大度に応じて対応計画とADRを作成する。
- ログやストレージに個人情報を保持しない方針を標準とし、例外が必要な場合はマスキングと保存期間を仕様に明記する。
理由: セキュリティ事故とコンプライアンス違反を未然に防ぎ、最小権限で安全に運用するため。

### 原則V: リリースと変更統制の厳格運用
- mainブランチへの直コミットを禁止し、全ての変更はPRでレビューとドキュメント更新要否を明示する。
- 自動リリースノート生成を運用し、Conventional Commits等の命名規約で精度を担保しつつ重要変更は追記する。
- 破壊的変更はADRまたはCHANGELOGに記録し、移行手順と検証観点を示した上でリリースする。
理由: 変更管理を透明化し、利用者と開発者間の期待値齟齬やリスクを抑制するため。

## 非機能・設計ガードレール
- **設計指針**: 低結合・高凝集と可読性を重視し、主要コンポーネントの依存関係はMermaidで `docs/design/` に記載する。設計変更時は対応する図と本文を同期する。
- **データ管理**: データベースはマイグレーションで管理し、適用・ロールバック手順を仕様と設計に明記する。PIIを扱う場合は保存期間と削除方針を要件化する。
- **インフラとコスト**: 無料/安価枠を優先し、選定理由と移行条件はADRに記録する。コスト増加トリガーを定義し、閾値到達時の対応を事前に決める。
- **可観測性運用**: 構造化ログと相関IDの他、主要メトリクスとアラート方針を最小構成で定義し、通知経路(メール/チャット等)を設計に残す。

## 開発ワークフローとレビュー
1. 要求→シナリオ→要件→ユースケース→仕様→設計→実装→テストの順序で成果物を作成し、各段階で上位成果物へのリンクを明記する。
2. 各成果物は `docs/` 以下の対応ディレクトリにMarkdownで配置し、名称は1件1ファイル原則とする。
3. 設計段階でクラス図/依存図をMermaidで作成し、レビューでは原則と矛盾がないか検証する。
4. 実装前にテストを先行させ、CIでユニット/E2E/カバレッジ計測を実行する。必要に応じてローカルで補完する。
5. レビューでは設計上の整合性、ドキュメント・ADRとの矛盾、構造化ログ・マスキング遵守を必ず確認する。
6. リリース前に構造化ログ出力と相関ID、Secrets設定、マイグレーション手順、リリースノート生成結果を検証する。

## Governance
- **改定手続き**: 憲章を改定する場合は影響分析を実施し、関連テンプレート・ガイドの同期を完了させた上でADRに決定理由を記録する。改定日にはバージョンをセマンティックバージョニングで更新する。
- **バージョン規則**: 原則/統治の破棄・再定義はMAJOR、原則や拘束力のある節の追加・大幅拡張はMINOR、表現調整や明確化はPATCHとする。
- **遵守確認**: PRと定期レビュー時にCore Principlesとガードレール、ワークフローをチェックし、違反時は是正計画をタスク化する。重大な逸脱はADRとリリースノートに記録する。

**Version**: 3.0.0 | **Ratified**: 2025-09-26 | **Last Amended**: 2025-09-26
